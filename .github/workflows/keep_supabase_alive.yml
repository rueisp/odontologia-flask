# .github/workflows/keep_supabase_alive.yml

name: Keep Supabase Project Alive

on:
  schedule:
    # Corre a medianoche UTC los Lunes, Miércoles y Viernes.
    # Ajusta la frecuencia si necesitas más pings.
    # Por ejemplo, '0 */12 * * *' para cada 12 horas.
    - cron: '0 0 * * 1,3,5' 

jobs:
  ping:
    runs-on: ubuntu-latest
    # Define variables de entorno para este job.
    # Aquí inyectamos el SECRET que crearemos en GitHub.
    env:
      DATABASE_URL_SUPABASE: ${{ secrets.SUPABASE_DATABASE_URL }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v3 

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10' 

      - name: Install dependencies
        # Instalar psycopg2-binary para poder conectar a PostgreSQL
        run: pip install psycopg2-binary

      - name: Ping Supabase Database
        # Este comando de Python se conectará a tu DB de Supabase
        run: |
          python -c "import psycopg2, os, datetime, sys; \
          db_url = os.environ.get('DATABASE_URL_SUPABASE'); \
          if not db_url: print(f'[{datetime.datetime.now()}] ERROR: DATABASE_URL_SUPABASE no está configurada.', file=sys.stderr); sys.exit(1); \
          try: \
            conn = psycopg2.connect(db_url); \
            cur = conn.cursor(); \
            cur.execute('SELECT 1'); \
            cur.close(); \
            conn.close(); \
            print(f'[{datetime.datetime.now()}] INFO: Ping exitoso a Supabase.'); \
          except Exception as e: \
            print(f'[{datetime.datetime.now()}] ERROR: Falló el ping a Supabase: {e}', file=sys.stderr); sys.exit(1);"