name: Keep Apps Alive (Render + Supabase)
on:
  schedule:
    # Se ejecuta CADA 15 MINUTOS, TODOS LOS DÍAS (24/7)
    - cron: '*/15 * * * *' 
  
  workflow_dispatch: # Permite ejecución manual

jobs:
  ping:
    runs-on: ubuntu-latest
    env:
      # Variables necesarias
      RENDER_URL: ${{ secrets.RENDER_APP_URL }}
      DATABASE_URL_SUPABASE: ${{ secrets.SUPABASE_DATABASE_URL }} # Mantenemos el secreto de Supabase
      
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        # Asegúrate de que 'requests' y 'psycopg2-binary' estén aquí
        run: pip install requests psycopg2-binary

      # --- PASO 1: Ping a RENDER (Cada hora) ---
      - name: Ping Render App at /awake
        run: |
          python -c "import requests; response = requests.get('$RENDER_URL/awake', timeout=60); print(f'Render Ping: {response.status_code}')"

      # --- PASO 2: Ping a SUPABASE (Usando tu script existente) ---
      - name: Ping Supabase Database
        # Este paso ejecutará tu script original, que debería usar DATABASE_URL_SUPABASE
        run: python ping_supabase.py